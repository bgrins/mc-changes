<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>testing policy - mc-changes</title>
  <link href='../static/page.css' rel='stylesheet' type='text/css'>
  <link href='../static/areweyet/apexcharts.css' rel='stylesheet' type='text/css'>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âž²</text></svg>">
</head>

<body class="loading-data">
  <h1>mc changes</h1>
  <div id="links">
    <a href="../">Change Report</a>
    <a href="./">Testing Policy Report</a>
  </div>
  <div class="loader"></div>
  <div id="grid">
    <aside>
      <h3>Controls</h3>
      <ul>
        <li><label><input name="grouping" type="radio" value="daily" />Daily</label></li>
        <li><label><input name="grouping" type="radio" value="weekly" checked />Weekly</label></li>
        <li><label><input name="grouping" type="radio" value="monthly" />Monthly</label></li>
      </ul>
    </aside>
    <main>
      <div id="chart"></div>
    </main>
  </div>

  <script src="../static/areweyet/apexcharts.js"></script>
  <script src="../static/proposal-temporal.js"></script>
  <script src="../static/localforage.js"></script>
  <script src="../static/common.js"></script>
  <script>
    (function () {
      let chart = null;
      let radios = [...document.querySelectorAll("input[name=grouping]")];
      var previouslySelected = document.querySelector("input[name=grouping]:checked");
      for (let radio of radios) {
        radio.addEventListener("change", function () {
          if (this !== previouslySelected) {
            previouslySelected = this;
            rerender(this.value);
          }
        });
      }

      async function rerender(grouping) {
        let summaryData = await getTestingPolicySummaryData(grouping);
        // console.log(summaryData);

        let series = [];
        let colors = [];
        for (let tag in TESTING_TAGS) {
          series.push({ name: TESTING_TAGS[tag].label, data: [] });
          colors.push(TESTING_TAGS[tag].color);
        }

        let xaxisCategories = [];
        for (let date in summaryData) {
          xaxisCategories.push(date);
          let i = 0;
          for (let tag in summaryData[date]) {
            series[i].data.push(summaryData[date][tag]);
            i++;
          }
        }

        // var options = {
        //   series,
        //   colors,
        //   chart: {
        //     height: 350,
        //     type: "line",
        //     zoom: {
        //       enabled: false,
        //     },
        //   },
        //   dataLabels: {
        //     enabled: false,
        //   },
        //   stroke: {
        //     curve: "straight",
        //   },
        //   grid: {
        //     row: {
        //       colors: ["#f3f3f3", "transparent"], // takes an array which will be repeated on columns
        //       opacity: 0.5,
        //     },
        //   },
        //   xaxis: {
        //     categories: xaxisCategories,
        //   },
        // };

        if (chart) {
          chart.destroy();
        }

        var options = {
          series,
          colors,
          chart: {
            type: 'bar',
            height: 350,
            stacked: true,
            toolbar: {
              show: true
            },
            zoom: {
              enabled: true
            }
          },
          plotOptions: {
            bar: {
              horizontal: false,
            },
          },
          xaxis: {
            categories: xaxisCategories
          }
        };


        chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
      }
      rerender(previouslySelected ? previouslySelected.value : undefined);
    })();
  </script>
</body>

</html>